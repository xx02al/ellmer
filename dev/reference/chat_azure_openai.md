# Chat with a model hosted on Azure OpenAI

The [Azure OpenAI
server](https://azure.microsoft.com/en-us/products/ai-services/openai-service)
hosts a number of open source models as well as proprietary models from
OpenAI.

Built on top of
[`chat_openai_compatible()`](https://ellmer.tidyverse.org/dev/reference/chat_openai_compatible.md).

### Authentication

`chat_azure_openai()` supports API keys and the `credentials` parameter,
but it also makes use of:

- Azure service principals (when the `AZURE_TENANT_ID`,
  `AZURE_CLIENT_ID`, and `AZURE_CLIENT_SECRET` environment variables are
  set).

- Interactive Entra ID authentication, like the Azure CLI.

- Viewer-based credentials on Posit Connect. Requires the connectcreds
  package.

## Usage

``` r
chat_azure_openai(
  endpoint = azure_endpoint(),
  model,
  params = NULL,
  api_version = NULL,
  system_prompt = NULL,
  api_key = NULL,
  credentials = NULL,
  api_args = list(),
  echo = c("none", "output", "all"),
  api_headers = character(),
  deployment_id = deprecated()
)
```

## Arguments

- endpoint:

  Azure OpenAI endpoint url with protocol and hostname, i.e.
  `https://{your-resource-name}.openai.azure.com`. Defaults to using the
  value of the `AZURE_OPENAI_ENDPOINT` environment variable.

- model:

  The **deployment id** for the model you want to use.

- params:

  Common model parameters, usually created by
  [`params()`](https://ellmer.tidyverse.org/dev/reference/params.md).

- api_version:

  The API version to use.

- system_prompt:

  A system prompt to set the behavior of the assistant.

- api_key:

  **\[deprecated\]** Use `credentials` instead.

- credentials:

  Override the default credentials. You generally should not need this
  argument; instead set the `AZURE_OPENAI_API_KEY` environment variable.
  The best place to set this is in `.Renviron`, which you can easily
  edit by calling `usethis::edit_r_environ()`.

  If you do need additional control, this argument takes a zero-argument
  function that returns either a string (the API key), or a named list
  (added as additional headers to every request).

- api_args:

  Named list of arbitrary extra arguments appended to the body of every
  chat API call. Combined with the body object generated by ellmer with
  [`modifyList()`](https://rdrr.io/r/utils/modifyList.html).

- echo:

  One of the following options:

  - `none`: don't emit any output (default when running in a function).

  - `output`: echo text and tool-calling output as it streams in
    (default when running at the console).

  - `all`: echo all input and output.

  Note this only affects the
  [`chat()`](https://ellmer.tidyverse.org/dev/reference/chat-any.md)
  method.

- api_headers:

  Named character vector of arbitrary extra headers appended to every
  chat API call.

- deployment_id:

  **\[deprecated\]** Use `model` instead.

## Value

A [Chat](https://ellmer.tidyverse.org/dev/reference/Chat.md) object.

## See also

Other chatbots:
[`chat_anthropic()`](https://ellmer.tidyverse.org/dev/reference/chat_anthropic.md),
[`chat_aws_bedrock()`](https://ellmer.tidyverse.org/dev/reference/chat_aws_bedrock.md),
[`chat_cloudflare()`](https://ellmer.tidyverse.org/dev/reference/chat_cloudflare.md),
[`chat_databricks()`](https://ellmer.tidyverse.org/dev/reference/chat_databricks.md),
[`chat_deepseek()`](https://ellmer.tidyverse.org/dev/reference/chat_deepseek.md),
[`chat_github()`](https://ellmer.tidyverse.org/dev/reference/chat_github.md),
[`chat_google_gemini()`](https://ellmer.tidyverse.org/dev/reference/chat_google_gemini.md),
[`chat_groq()`](https://ellmer.tidyverse.org/dev/reference/chat_groq.md),
[`chat_huggingface()`](https://ellmer.tidyverse.org/dev/reference/chat_huggingface.md),
[`chat_mistral()`](https://ellmer.tidyverse.org/dev/reference/chat_mistral.md),
[`chat_ollama()`](https://ellmer.tidyverse.org/dev/reference/chat_ollama.md),
[`chat_openai()`](https://ellmer.tidyverse.org/dev/reference/chat_openai.md),
[`chat_openai_compatible()`](https://ellmer.tidyverse.org/dev/reference/chat_openai_compatible.md),
[`chat_openrouter()`](https://ellmer.tidyverse.org/dev/reference/chat_openrouter.md),
[`chat_perplexity()`](https://ellmer.tidyverse.org/dev/reference/chat_perplexity.md),
[`chat_portkey()`](https://ellmer.tidyverse.org/dev/reference/chat_portkey.md)

## Examples

``` r
if (FALSE) { # \dontrun{
chat <- chat_azure_openai(model = "gpt-4o-mini")
chat$chat("Tell me three jokes about statisticians")
} # }
```
