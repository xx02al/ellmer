<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Reject a tool call — tool_reject • ellmer</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Reject a tool call — tool_reject"><meta name="description" content="Throws an error to reject a tool call. tool_reject() can be used within the
tool function to indicate that the tool call should not be processed.
tool_reject() can also be called in an Chat$on_tool_request() callback.
When used in the callback, the tool call is rejected before the tool
function is invoked.
Here's an example where utils::askYesNo() is used to ask the user for
permission before accessing their current working directory. This happens
directly in the tool function and is appropriate when you write the tool
definition and know exactly how it will be called.
chat &amp;lt;- chat_openai(model = &quot;gpt-4.1-nano&quot;)

list_files &amp;lt;- function() {
  allow_read &amp;lt;- utils::askYesNo(
    &quot;Would you like to allow access to your current directory?&quot;
  )
  if (isTRUE(allow_read)) {
    dir(pattern = &quot;[.](r|R|csv)$&quot;)
  } else {
    tool_reject()
  }
}

chat$register_tool(tool(
  list_files,
  &quot;List files in the user's current directory&quot;
))

chat$chat(&quot;What files are available in my current directory?&quot;)
#&amp;gt; [tool call] list_files()
#&amp;gt; Would you like to allow access to your current directory? (Yes/no/cancel) no
#&amp;gt; #&amp;gt; Error: Tool call rejected. The user has chosen to disallow the tool #' call.
#&amp;gt; It seems I am unable to access the files in your current directory right now.
#&amp;gt; If you can tell me what specific files you're looking for or if you can #' provide
#&amp;gt; the list, I can assist you further.

chat$chat(&quot;Try again.&quot;)
#&amp;gt; [tool call] list_files()
#&amp;gt; Would you like to allow access to your current directory? (Yes/no/cancel) yes
#&amp;gt; #&amp;gt; app.R
#&amp;gt; #&amp;gt; data.csv
#&amp;gt; The files available in your current directory are &quot;app.R&quot; and &quot;data.csv&quot;.

You can achieve a similar experience with tools written by others by using a
tool_request callback. In the next example, imagine the tool is provided by
a third-party package. This example implements a simple menu to ask the user
for consent before running any  tool.
packaged_list_files_tool &amp;lt;- tool(
  function() dir(pattern = &quot;[.](r|R|csv)$&quot;),
  &quot;List files in the user's current directory&quot;
)

chat &amp;lt;- chat_openai(model = &quot;gpt-4.1-nano&quot;)
chat$register_tool(packaged_list_files_tool)

always_allowed &amp;lt;- c()

# ContentToolRequest
chat$on_tool_request(function(request) {
  if (request@name %in% always_allowed) return()

  answer &amp;lt;- utils::menu(
    title = sprintf(&quot;Allow tool `%s()` to run?&quot;, request@name),
    choices = c(&quot;Always&quot;, &quot;Once&quot;, &quot;No&quot;),
    graphics = FALSE
  )

  if (answer == 1) {
    always_allowed &amp;lt;&amp;lt;- append(always_allowed, request@name)
  } else if (answer %in% c(0, 3)) {
    tool_reject()
  }
})

# Try choosing different answers to the menu each time
chat$chat(&quot;What files are available in my current directory?&quot;)
chat$chat(&quot;How about now?&quot;)
chat$chat(&quot;And again now?&quot;)
"><meta property="og:description" content="Throws an error to reject a tool call. tool_reject() can be used within the
tool function to indicate that the tool call should not be processed.
tool_reject() can also be called in an Chat$on_tool_request() callback.
When used in the callback, the tool call is rejected before the tool
function is invoked.
Here's an example where utils::askYesNo() is used to ask the user for
permission before accessing their current working directory. This happens
directly in the tool function and is appropriate when you write the tool
definition and know exactly how it will be called.
chat &amp;lt;- chat_openai(model = &quot;gpt-4.1-nano&quot;)

list_files &amp;lt;- function() {
  allow_read &amp;lt;- utils::askYesNo(
    &quot;Would you like to allow access to your current directory?&quot;
  )
  if (isTRUE(allow_read)) {
    dir(pattern = &quot;[.](r|R|csv)$&quot;)
  } else {
    tool_reject()
  }
}

chat$register_tool(tool(
  list_files,
  &quot;List files in the user's current directory&quot;
))

chat$chat(&quot;What files are available in my current directory?&quot;)
#&amp;gt; [tool call] list_files()
#&amp;gt; Would you like to allow access to your current directory? (Yes/no/cancel) no
#&amp;gt; #&amp;gt; Error: Tool call rejected. The user has chosen to disallow the tool #' call.
#&amp;gt; It seems I am unable to access the files in your current directory right now.
#&amp;gt; If you can tell me what specific files you're looking for or if you can #' provide
#&amp;gt; the list, I can assist you further.

chat$chat(&quot;Try again.&quot;)
#&amp;gt; [tool call] list_files()
#&amp;gt; Would you like to allow access to your current directory? (Yes/no/cancel) yes
#&amp;gt; #&amp;gt; app.R
#&amp;gt; #&amp;gt; data.csv
#&amp;gt; The files available in your current directory are &quot;app.R&quot; and &quot;data.csv&quot;.

You can achieve a similar experience with tools written by others by using a
tool_request callback. In the next example, imagine the tool is provided by
a third-party package. This example implements a simple menu to ask the user
for consent before running any  tool.
packaged_list_files_tool &amp;lt;- tool(
  function() dir(pattern = &quot;[.](r|R|csv)$&quot;),
  &quot;List files in the user's current directory&quot;
)

chat &amp;lt;- chat_openai(model = &quot;gpt-4.1-nano&quot;)
chat$register_tool(packaged_list_files_tool)

always_allowed &amp;lt;- c()

# ContentToolRequest
chat$on_tool_request(function(request) {
  if (request@name %in% always_allowed) return()

  answer &amp;lt;- utils::menu(
    title = sprintf(&quot;Allow tool `%s()` to run?&quot;, request@name),
    choices = c(&quot;Always&quot;, &quot;Once&quot;, &quot;No&quot;),
    graphics = FALSE
  )

  if (answer == 1) {
    always_allowed &amp;lt;&amp;lt;- append(always_allowed, request@name)
  } else if (answer %in% c(0, 3)) {
    tool_reject()
  }
})

# Try choosing different answers to the menu each time
chat$chat(&quot;What files are available in my current directory?&quot;)
chat$chat(&quot;How about now?&quot;)
chat$chat(&quot;And again now?&quot;)
"><meta property="og:image" content="https://ellmer.tidyverse.org/logo.png"><meta name="robots" content="noindex"><script defer data-domain="ellmer.tidyverse.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ellmer</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.1.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/ellmer.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/programming.html">Programming with ellmer</a></li>
    <li><a class="dropdown-item" href="../articles/prompt-design.html">Prompt design</a></li>
    <li><a class="dropdown-item" href="../articles/streaming-async.html">Streaming and async APIs</a></li>
    <li><a class="dropdown-item" href="../articles/structured-data.html">Structured data</a></li>
    <li><a class="dropdown-item" href="../articles/tool-calling.html">Tool/function calling</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidyverse/ellmer/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Reject a tool call</h1>
      <small class="dont-index">Source: <a href="https://github.com/tidyverse/ellmer/blob/main/R/tools-def.R" class="external-link"><code>R/tools-def.R</code></a></small>
      <div class="d-none name"><code>tool_reject.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Throws an error to reject a tool call. <code>tool_reject()</code> can be used within the
tool function to indicate that the tool call should not be processed.
<code>tool_reject()</code> can also be called in an <code>Chat$on_tool_request()</code> callback.
When used in the callback, the tool call is rejected before the tool
function is invoked.</p>
<p>Here's an example where <code><a href="https://rdrr.io/r/utils/askYesNo.html" class="external-link">utils::askYesNo()</a></code> is used to ask the user for
permission before accessing their current working directory. This happens
directly in the tool function and is appropriate when you write the tool
definition and know exactly how it will be called.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">chat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/chat_openai.html">chat_openai</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"gpt-4.1-nano"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">list_files</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">allow_read</span> <span class="op">&lt;-</span> <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/askYesNo.html" class="external-link">askYesNo</a></span><span class="op">(</span></span>
<span>    <span class="st">"Would you like to allow access to your current directory?"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></span><span class="op">(</span><span class="va">allow_read</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"[.](r|R|csv)$"</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/tool_reject.html">tool_reject</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">chat</span><span class="op">$</span><span class="fu">register_tool</span><span class="op">(</span><span class="fu"><a href="../reference/tool.html">tool</a></span><span class="op">(</span></span>
<span>  <span class="va">list_files</span>,</span>
<span>  <span class="st">"List files in the user's current directory"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">chat</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span><span class="st">"What files are available in my current directory?"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [tool call] list_files()</span></span>
<span><span class="co">#&gt; Would you like to allow access to your current directory? (Yes/no/cancel) no</span></span>
<span><span class="co">#&gt; #&gt; Error: Tool call rejected. The user has chosen to disallow the tool #' call.</span></span>
<span><span class="co">#&gt; It seems I am unable to access the files in your current directory right now.</span></span>
<span><span class="co">#&gt; If you can tell me what specific files you're looking for or if you can #' provide</span></span>
<span><span class="co">#&gt; the list, I can assist you further.</span></span>
<span></span>
<span><span class="va">chat</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span><span class="st">"Try again."</span><span class="op">)</span></span>
<span><span class="co">#&gt; [tool call] list_files()</span></span>
<span><span class="co">#&gt; Would you like to allow access to your current directory? (Yes/no/cancel) yes</span></span>
<span><span class="co">#&gt; #&gt; app.R</span></span>
<span><span class="co">#&gt; #&gt; data.csv</span></span>
<span><span class="co">#&gt; The files available in your current directory are "app.R" and "data.csv".</span></span></code></pre><p></p></div>
<p>You can achieve a similar experience with tools written by others by using a
<code>tool_request</code> callback. In the next example, imagine the tool is provided by
a third-party package. This example implements a simple menu to ask the user
for consent before running <em>any</em>  tool.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">packaged_list_files_tool</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tool.html">tool</a></span><span class="op">(</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"[.](r|R|csv)$"</span><span class="op">)</span>,</span>
<span>  <span class="st">"List files in the user's current directory"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">chat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/chat_openai.html">chat_openai</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"gpt-4.1-nano"</span><span class="op">)</span></span>
<span><span class="va">chat</span><span class="op">$</span><span class="fu">register_tool</span><span class="op">(</span><span class="va">packaged_list_files_tool</span><span class="op">)</span></span>
<span></span>
<span><span class="va">always_allowed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ContentToolRequest</span></span>
<span><span class="va">chat</span><span class="op">$</span><span class="fu">on_tool_request</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">request</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">request</span><span class="op">@</span><span class="va">name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">always_allowed</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">answer</span> <span class="op">&lt;-</span> <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/menu.html" class="external-link">menu</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Allow tool `%s()` to run?"</span>, <span class="va">request</span><span class="op">@</span><span class="va">name</span><span class="op">)</span>,</span>
<span>    choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Always"</span>, <span class="st">"Once"</span>, <span class="st">"No"</span><span class="op">)</span>,</span>
<span>    graphics <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">answer</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">always_allowed</span> <span class="op">&lt;&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/append.html" class="external-link">append</a></span><span class="op">(</span><span class="va">always_allowed</span>, <span class="va">request</span><span class="op">@</span><span class="va">name</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">answer</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/tool_reject.html">tool_reject</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Try choosing different answers to the menu each time</span></span>
<span><span class="va">chat</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span><span class="st">"What files are available in my current directory?"</span><span class="op">)</span></span>
<span><span class="va">chat</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span><span class="st">"How about now?"</span><span class="op">)</span></span>
<span><span class="va">chat</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span><span class="st">"And again now?"</span><span class="op">)</span></span></code></pre><p></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">tool_reject</span><span class="op">(</span>reason <span class="op">=</span> <span class="st">"The user has chosen to disallow the tool call."</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-reason">reason<a class="anchor" aria-label="anchor" href="#arg-reason"></a></dt>
<dd><p>A character string describing the reason for rejecting the
tool call.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Throws an error of class <code>ellmer_tool_reject</code> with the provided
reason.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other tool calling helpers:
<code><a href="tool.html">tool</a>()</code>,
<code><a href="tool_annotations.html">tool_annotations</a>()</code></p></div>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://hadley.nz" class="external-link">Hadley Wickham</a>, Joe Cheng, Aaron Jacobs, <a href="https://garrickadenbuie.com" class="external-link">Garrick Aden-Buie</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

  </div></footer></body></html>

