<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Chat with an Anthropic Claude model — chat_anthropic • ellmer</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Chat with an Anthropic Claude model — chat_anthropic"><meta name="description" content="Anthropic provides a number of chat based models
under the Claude moniker. Note that a
Claude Pro membership does not give you the ability to call models via the
API; instead, you will need to sign up (and pay for) a
developer account."><meta property="og:description" content="Anthropic provides a number of chat based models
under the Claude moniker. Note that a
Claude Pro membership does not give you the ability to call models via the
API; instead, you will need to sign up (and pay for) a
developer account."><meta property="og:image" content="https://ellmer.tidyverse.org/logo.png"><meta name="robots" content="noindex"><script src="https://cdn.jsdelivr.net/gh/posit-dev/supported-by-posit/js/badge.min.js" data-max-height="43" data-light-bg="#666f76" data-light-fg="#f9f9f9"></script><script defer data-domain="ellmer.tidyverse.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ellmer</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.4.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/ellmer.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/programming.html">Programming with ellmer</a></li>
    <li><a class="dropdown-item" href="../articles/prompt-design.html">Prompt design</a></li>
    <li><a class="dropdown-item" href="../articles/streaming-async.html">Streaming and async APIs</a></li>
    <li><a class="dropdown-item" href="../articles/structured-data.html">Structured data</a></li>
    <li><a class="dropdown-item" href="../articles/tool-calling.html">Tool/function calling</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news"><li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://tidyverse.org/blog/2025/11/ellmer-0-4-0/">Version 0.4.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2025/07/ellmer-0-3-0/">Version 0.3.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2025/05/ellmer-0-2-0/">Version 0.2.0</a></li>
    <li><a class="external-link dropdown-item" href="https://posit.co/blog/announcing-ellmer/">Version 0.1.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidyverse/ellmer/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Chat with an Anthropic Claude model</h1>
      <small class="dont-index">Source: <a href="https://github.com/tidyverse/ellmer/blob/main/R/provider-claude.R" class="external-link"><code>R/provider-claude.R</code></a></small>
      <div class="d-none name"><code>chat_anthropic.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><a href="https://www.anthropic.com" class="external-link">Anthropic</a> provides a number of chat based models
under the <a href="https://claude.com/product/overview" class="external-link">Claude</a> moniker. Note that a
Claude Pro membership does not give you the ability to call models via the
API; instead, you will need to sign up (and pay for) a
<a href="https://platform.claude.com/" class="external-link">developer account</a>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">chat_anthropic</span><span class="op">(</span></span>
<span>  system_prompt <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  params <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  model <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cache <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"5m"</span>, <span class="st">"1h"</span>, <span class="st">"none"</span><span class="op">)</span>,</span>
<span>  api_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  base_url <span class="op">=</span> <span class="st">"https://api.anthropic.com/v1"</span>,</span>
<span>  beta_headers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  api_key <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  credentials <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  api_headers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  echo <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">chat_claude</span><span class="op">(</span></span>
<span>  system_prompt <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  params <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  model <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cache <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"5m"</span>, <span class="st">"1h"</span>, <span class="st">"none"</span><span class="op">)</span>,</span>
<span>  api_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  base_url <span class="op">=</span> <span class="st">"https://api.anthropic.com/v1"</span>,</span>
<span>  beta_headers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  api_key <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  credentials <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  api_headers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  echo <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">models_claude</span><span class="op">(</span></span>
<span>  base_url <span class="op">=</span> <span class="st">"https://api.anthropic.com/v1"</span>,</span>
<span>  api_key <span class="op">=</span> <span class="fu">anthropic_key</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">models_anthropic</span><span class="op">(</span></span>
<span>  base_url <span class="op">=</span> <span class="st">"https://api.anthropic.com/v1"</span>,</span>
<span>  api_key <span class="op">=</span> <span class="fu">anthropic_key</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-system-prompt">system_prompt<a class="anchor" aria-label="anchor" href="#arg-system-prompt"></a></dt>
<dd><p>A system prompt to set the behavior of the assistant.</p></dd>


<dt id="arg-params">params<a class="anchor" aria-label="anchor" href="#arg-params"></a></dt>
<dd><p>Common model parameters, usually created by <code><a href="params.html">params()</a></code>.</p></dd>


<dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>The model to use for the chat (defaults to "claude-sonnet-4-5-20250929").
We regularly update the default, so we strongly recommend explicitly specifying a model for anything other than casual use.
Use <code>models_anthropic()</code> to see all options.</p></dd>


<dt id="arg-cache">cache<a class="anchor" aria-label="anchor" href="#arg-cache"></a></dt>
<dd><p>How long to cache inputs? Defaults to "5m" (five minutes).
Set to "none" to disable caching or "1h" to cache for one hour.</p>
<p>See details below.</p></dd>


<dt id="arg-api-args">api_args<a class="anchor" aria-label="anchor" href="#arg-api-args"></a></dt>
<dd><p>Named list of arbitrary extra arguments appended to the body
of every chat API call. Combined with the body object generated by ellmer
with <code><a href="https://rdrr.io/r/utils/modifyList.html" class="external-link">modifyList()</a></code>.</p></dd>


<dt id="arg-base-url">base_url<a class="anchor" aria-label="anchor" href="#arg-base-url"></a></dt>
<dd><p>The base URL to the endpoint; the default is Claude's
public API.</p></dd>


<dt id="arg-beta-headers">beta_headers<a class="anchor" aria-label="anchor" href="#arg-beta-headers"></a></dt>
<dd><p>Optionally, a character vector of beta headers to opt-in
claude features that are still in beta.</p></dd>


<dt id="arg-api-key">api_key<a class="anchor" aria-label="anchor" href="#arg-api-key"></a></dt>
<dd><p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated" class="external-link"><img src="figures/lifecycle-deprecated.svg" alt="[Deprecated]"></a> Use <code>credentials</code> instead.</p></dd>


<dt id="arg-credentials">credentials<a class="anchor" aria-label="anchor" href="#arg-credentials"></a></dt>
<dd><p>Override the default credentials. You generally should not need this argument; instead set the <code>ANTHROPIC_API_KEY</code> environment variable. The best place to set this is in <code>.Renviron</code>,
which you can easily edit by calling <code>usethis::edit_r_environ()</code>.</p>
<p>If you do need additional control, this argument takes a zero-argument function that returns either a string (the API key), or a named list (added as additional headers to every request).</p></dd>


<dt id="arg-api-headers">api_headers<a class="anchor" aria-label="anchor" href="#arg-api-headers"></a></dt>
<dd><p>Named character vector of arbitrary extra headers appended
to every chat API call.</p></dd>


<dt id="arg-echo">echo<a class="anchor" aria-label="anchor" href="#arg-echo"></a></dt>
<dd><p>One of the following options:</p><ul><li><p><code>none</code>: don't emit any output (default when running in a function).</p></li>
<li><p><code>output</code>: echo text and tool-calling output as it streams in (default
when running at the console).</p></li>
<li><p><code>all</code>: echo all input and output.</p></li>
</ul><p>Note this only affects the <code><a href="chat-any.html">chat()</a></code> method.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <a href="Chat.html">Chat</a> object.</p>
    </div>
    <div class="section level2">
    <h2 id="caching">Caching<a class="anchor" aria-label="anchor" href="#caching"></a></h2>
    <p>Caching with Claude is a bit more complicated than other providers but we
believe that on average it will save you both money and time, so we have
enabled it by default. With other providers, like OpenAI and Google,
you only pay for cache reads, which cost 10% of the normal price. With
Claude, you also pay for cache writes, which cost 125% of the normal price
for 5 minute caching and 200% of the normal price for 1 hour caching.</p>
<p>How does this affect the total cost of a conversation? Imagine the first
turn sends 1000 input tokens and receives 200 output tokens. The second
turn must first send both the input and output from the previous turn
(1200 tokens). It then sends a further 1000 tokens and receives 200 tokens
back.</p>
<p>To compare the prices of these two approaches we can ignore the cost of
output tokens, because they are the same for both. How much will the input
tokens cost? If we don't use caching, we send 1000 tokens in the first turn
and 2200 (1000 + 200 + 1000) tokens in the second turn for a total of 3200
tokens. If we use caching, we'll send (the equivalent of) 1000 * 1.25 = 1250
tokens in the first turn. In the second turn, 1000 of the input tokens will
be cached so the total cost is 1000 * 0.1 + (200 + 1000) * 1.25 = 1600
tokens. That makes a total of 2850 tokens, i.e. 11% fewer tokens,
decreasing the overall cost.</p>
<p>Obviously, the details will vary from conversation to conversation, but
if you have a large system prompt that you re-use many times you should
expect to see larger savings. You can see exactly how many input and
cache input tokens each turn uses, along with the total cost,
with <code>chat$get_tokens()</code>. If you don't see savings for your use case, you can
suppress caching with <code>cache = "none"</code>.</p>
<p>I know this is already quite complicated, but there's one final wrinkle:
Claude will only cache longer prompts, with caching requiring at least
1024-4096 tokens, depending on the model. So don't be surprised it if you
don't see any differences with caching if you have a short prompt.</p>
<p>See all the details at
<a href="https://docs.claude.com/en/docs/build-with-claude/prompt-caching" class="external-link">https://docs.claude.com/en/docs/build-with-claude/prompt-caching</a>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other chatbots:
<code><a href="chat_aws_bedrock.html">chat_aws_bedrock()</a></code>,
<code><a href="chat_azure_openai.html">chat_azure_openai()</a></code>,
<code><a href="chat_cloudflare.html">chat_cloudflare()</a></code>,
<code><a href="chat_databricks.html">chat_databricks()</a></code>,
<code><a href="chat_deepseek.html">chat_deepseek()</a></code>,
<code><a href="chat_github.html">chat_github()</a></code>,
<code><a href="chat_google_gemini.html">chat_google_gemini()</a></code>,
<code><a href="chat_groq.html">chat_groq()</a></code>,
<code><a href="chat_huggingface.html">chat_huggingface()</a></code>,
<code><a href="chat_mistral.html">chat_mistral()</a></code>,
<code><a href="chat_ollama.html">chat_ollama()</a></code>,
<code><a href="chat_openai.html">chat_openai()</a></code>,
<code><a href="chat_openai_compatible.html">chat_openai_compatible()</a></code>,
<code><a href="chat_openrouter.html">chat_openrouter()</a></code>,
<code><a href="chat_perplexity.html">chat_perplexity()</a></code>,
<code><a href="chat_portkey.html">chat_portkey()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">chat</span> <span class="op">&lt;-</span> <span class="fu">chat_anthropic</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Using <span style="color: #00BB00;">model</span> = <span style="color: #0000BB;">"claude-sonnet-4-5-20250929"</span>.</span>
<span class="r-in"><span><span class="va">chat</span><span class="op">$</span><span class="fu">chat</span><span class="op">(</span><span class="st">"Tell me three jokes about statisticians"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> # Three Jokes About Statisticians</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **1. The Drowning Statistician**</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A statistician is someone who could drown crossing a river that's an </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> average of three feet deep.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **2. The Uncertain Response**</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Three statisticians go hunting. They spot a deer. The first </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> statistician shoots and misses—two feet to the left. The second shoots</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> and misses—two feet to the right. The third statistician jumps up and </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> down shouting, "We got it! We got it!"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **3. The Kidnapped Statistician**</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A kidnapper grabs a statistician and threatens, "Give me all your </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> money or you're average!" The statistician replies, "I think you mean </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 'or you're history.'" The kidnapper responds, "Don't tell me my </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> job—you tell me the mean!"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *These jokes play on statistical concepts like averages, means, and </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> the classic distinction between theoretical data and practical </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> reality!*</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://hadley.nz" class="external-link">Hadley Wickham</a>, Joe Cheng, Aaron Jacobs, <a href="https://garrickadenbuie.com" class="external-link">Garrick Aden-Buie</a>, <a href="http://schloerke.com" class="external-link">Barret Schloerke</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

  </div></footer></body></html>

