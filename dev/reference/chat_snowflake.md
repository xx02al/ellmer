# Chat with a model hosted on Snowflake

The Snowflake provider allows you to interact with LLM models available
through the [Cortex LLM REST
API](https://docs.snowflake.com/en/user-guide/snowflake-cortex/cortex-llm-rest-api).

### Authentication

`chat_snowflake()` picks up the following ambient Snowflake credentials:

- A static OAuth token defined via the `SNOWFLAKE_TOKEN` environment
  variable.

- Key-pair authentication credentials defined via the `SNOWFLAKE_USER`
  and `SNOWFLAKE_PRIVATE_KEY` (which can be a PEM-encoded private key or
  a path to one) environment variables.

- Posit Workbench-managed Snowflake credentials for the corresponding
  `account`.

- Viewer-based credentials on Posit Connect. Requires the connectcreds
  package.

### Known limitations

Note that Snowflake-hosted models do not support images.

## Usage

``` r
chat_snowflake(
  system_prompt = NULL,
  account = snowflake_account(),
  credentials = NULL,
  model = NULL,
  params = NULL,
  api_args = list(),
  echo = c("none", "output", "all"),
  api_headers = character()
)
```

## Arguments

- system_prompt:

  A system prompt to set the behavior of the assistant.

- account:

  A Snowflake [account
  identifier](https://docs.snowflake.com/en/user-guide/admin-account-identifier),
  e.g. `"testorg-test_account"`. Defaults to the value of the
  `SNOWFLAKE_ACCOUNT` environment variable.

- credentials:

  A list of authentication headers to pass into
  [`httr2::req_headers()`](https://httr2.r-lib.org/reference/req_headers.html),
  a function that returns them when called, or `NULL`, the default, to
  use ambient credentials.

- model:

  The model to use for the chat (defaults to "claude-3-7-sonnet"). We
  regularly update the default, so we strongly recommend explicitly
  specifying a model for anything other than casual use.

- params:

  Common model parameters, usually created by
  [`params()`](https://ellmer.tidyverse.org/dev/reference/params.md).

- api_args:

  Named list of arbitrary extra arguments appended to the body of every
  chat API call. Combined with the body object generated by ellmer with
  [`modifyList()`](https://rdrr.io/r/utils/modifyList.html).

- echo:

  One of the following options:

  - `none`: don't emit any output (default when running in a function).

  - `output`: echo text and tool-calling output as it streams in
    (default when running at the console).

  - `all`: echo all input and output.

  Note this only affects the
  [`chat()`](https://ellmer.tidyverse.org/dev/reference/chat-any.md)
  method.

- api_headers:

  Named character vector of arbitrary extra headers appended to every
  chat API call.

## Value

A [Chat](https://ellmer.tidyverse.org/dev/reference/Chat.md) object.

## Examples

``` r
if (FALSE) { # has_credentials("snowflake")
chat <- chat_snowflake()
chat$chat("Tell me a joke in the form of a SQL query.")
}
```
