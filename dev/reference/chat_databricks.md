# Chat with a model hosted on Databricks

Databricks provides out-of-the-box access to a number of [foundation
models](https://docs.databricks.com/en/machine-learning/model-serving/score-foundation-models.html)
and can also serve as a gateway for external models hosted by a third
party.

Built on top of
[`chat_openai_compatible()`](https://ellmer.tidyverse.org/dev/reference/chat_openai_compatible.md).

### Authentication

`chat_databricks()` picks up on ambient Databricks credentials for a
subset of the [Databricks client unified
authentication](https://docs.databricks.com/en/dev-tools/auth/unified-auth.html)
model. Specifically, it supports:

- Personal access tokens

- Service principals via OAuth (OAuth M2M)

- User account via OAuth (OAuth U2M)

- Authentication via the Databricks CLI

- Posit Workbench-managed credentials

- Viewer-based credentials on Posit Connect. Requires the connectcreds
  package.

## Usage

``` r
chat_databricks(
  workspace = databricks_workspace(),
  system_prompt = NULL,
  model = NULL,
  token = NULL,
  params = NULL,
  api_args = list(),
  echo = c("none", "output", "all"),
  api_headers = character()
)
```

## Arguments

- workspace:

  The URL of a Databricks workspace, e.g.
  `"https://example.cloud.databricks.com"`. Will use the value of the
  environment variable `DATABRICKS_HOST`, if set.

- system_prompt:

  A system prompt to set the behavior of the assistant.

- model:

  The model to use for the chat (defaults to
  "databricks-claude-3-7-sonnet"). We regularly update the default, so
  we strongly recommend explicitly specifying a model for anything other
  than casual use.

  Available foundational models include:

  - `databricks-claude-3-7-sonnet` (the default)

  - `databricks-mixtral-8x7b-instruct`

  - `databricks-meta-llama-3-1-70b-instruct`

  - `databricks-meta-llama-3-1-405b-instruct`

- token:

  An authentication token for the Databricks workspace, or `NULL` to use
  ambient credentials.

- params:

  Common model parameters, usually created by
  [`params()`](https://ellmer.tidyverse.org/dev/reference/params.md).

- api_args:

  Named list of arbitrary extra arguments appended to the body of every
  chat API call. Combined with the body object generated by ellmer with
  [`modifyList()`](https://rdrr.io/r/utils/modifyList.html).

- echo:

  One of the following options:

  - `none`: don't emit any output (default when running in a function).

  - `output`: echo text and tool-calling output as it streams in
    (default when running at the console).

  - `all`: echo all input and output.

  Note this only affects the
  [`chat()`](https://ellmer.tidyverse.org/dev/reference/chat-any.md)
  method.

- api_headers:

  Named character vector of arbitrary extra headers appended to every
  chat API call.

## Value

A [Chat](https://ellmer.tidyverse.org/dev/reference/Chat.md) object.

## See also

Other chatbots:
[`chat_anthropic()`](https://ellmer.tidyverse.org/dev/reference/chat_anthropic.md),
[`chat_aws_bedrock()`](https://ellmer.tidyverse.org/dev/reference/chat_aws_bedrock.md),
[`chat_azure_openai()`](https://ellmer.tidyverse.org/dev/reference/chat_azure_openai.md),
[`chat_cloudflare()`](https://ellmer.tidyverse.org/dev/reference/chat_cloudflare.md),
[`chat_deepseek()`](https://ellmer.tidyverse.org/dev/reference/chat_deepseek.md),
[`chat_github()`](https://ellmer.tidyverse.org/dev/reference/chat_github.md),
[`chat_google_gemini()`](https://ellmer.tidyverse.org/dev/reference/chat_google_gemini.md),
[`chat_groq()`](https://ellmer.tidyverse.org/dev/reference/chat_groq.md),
[`chat_huggingface()`](https://ellmer.tidyverse.org/dev/reference/chat_huggingface.md),
[`chat_mistral()`](https://ellmer.tidyverse.org/dev/reference/chat_mistral.md),
[`chat_ollama()`](https://ellmer.tidyverse.org/dev/reference/chat_ollama.md),
[`chat_openai()`](https://ellmer.tidyverse.org/dev/reference/chat_openai.md),
[`chat_openai_compatible()`](https://ellmer.tidyverse.org/dev/reference/chat_openai_compatible.md),
[`chat_openrouter()`](https://ellmer.tidyverse.org/dev/reference/chat_openrouter.md),
[`chat_perplexity()`](https://ellmer.tidyverse.org/dev/reference/chat_perplexity.md),
[`chat_portkey()`](https://ellmer.tidyverse.org/dev/reference/chat_portkey.md)

## Examples

``` r
if (FALSE) { # \dontrun{
chat <- chat_databricks()
chat$chat("Tell me three jokes about statisticians")
} # }
```
